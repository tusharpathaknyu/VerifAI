//------------------------------------------------------------------------------
// I2C Base Test
// Generated by VerifAI - Natural Language to UVM Testbench Generator
//------------------------------------------------------------------------------

`ifndef I2C_BASE_TEST_SV
`define I2C_BASE_TEST_SV

class i2c_base_test extends uvm_test;
    
    `uvm_component_utils(i2c_base_test)
    
    //--------------------------------------------------------------------------
    // Environment
    //--------------------------------------------------------------------------
    i2c_env             env;
    i2c_agent_config    master_cfg;
    
    //--------------------------------------------------------------------------
    // Test Configuration
    //--------------------------------------------------------------------------
    int unsigned test_timeout_ns = 1000000;  // 1ms default timeout
    
    //--------------------------------------------------------------------------
    // Constructor
    //--------------------------------------------------------------------------
    
    function new(string name = "i2c_base_test", uvm_component parent = null);
        super.new(name, parent);
    endfunction
    
    //--------------------------------------------------------------------------
    // Build Phase
    //--------------------------------------------------------------------------
    
    virtual function void build_phase(uvm_phase phase);
        super.build_phase(phase);
        
        // Create and configure master agent
        master_cfg = i2c_agent_config::type_id::create("master_cfg");
        configure_master_agent();
        
        // Set configuration in config_db
        uvm_config_db#(i2c_agent_config)::set(this, "env", "master_cfg", master_cfg);
        
        // Create environment
        env = i2c_env::type_id::create("env", this);
        
        `uvm_info("I2C_TEST", "Build phase complete", UVM_LOW)
    endfunction
    
    //--------------------------------------------------------------------------
    // Configure Master Agent
    //--------------------------------------------------------------------------
    
    virtual function void configure_master_agent();
        master_cfg.is_master = 1;
        master_cfg.is_active = UVM_ACTIVE;
        master_cfg.has_coverage = 1;
        
        // I2C timing parameters (Standard Mode - 100kHz default)
        master_cfg.speed_mode = I2C_STANDARD;
        
        // Can be overridden in derived tests
    endfunction
    
    //--------------------------------------------------------------------------
    // End of Elaboration Phase
    //--------------------------------------------------------------------------
    
    virtual function void end_of_elaboration_phase(uvm_phase phase);
        super.end_of_elaboration_phase(phase);
        
        // Print test configuration
        `uvm_info("I2C_TEST", $sformatf("Test: %s", get_type_name()), UVM_LOW)
        `uvm_info("I2C_TEST", $sformatf("Timeout: %0d ns", test_timeout_ns), UVM_LOW)
    endfunction
    
    //--------------------------------------------------------------------------
    // Run Phase
    //--------------------------------------------------------------------------
    
    virtual task run_phase(uvm_phase phase);
        phase.raise_objection(this, "I2C base test");
        
        `uvm_info("I2C_TEST", "Starting I2C base test", UVM_LOW)
        
        // Apply reset
        apply_reset();
        
        // Wait for reset to complete
        #100ns;
        
        // Run the main test sequence - override in derived tests
        run_test_sequence();
        
        // Allow time for completion
        #1000ns;
        
        `uvm_info("I2C_TEST", "I2C base test complete", UVM_LOW)
        
        phase.drop_objection(this, "I2C base test");
    endtask
    
    //--------------------------------------------------------------------------
    // Apply Reset
    //--------------------------------------------------------------------------
    
    virtual task apply_reset();
        `uvm_info("I2C_TEST", "Applying reset", UVM_MEDIUM)
        // Reset is typically handled by the top-level testbench
        // This is a placeholder for any test-specific reset handling
    endtask
    
    //--------------------------------------------------------------------------
    // Run Test Sequence - Override in derived tests
    //--------------------------------------------------------------------------
    
    virtual task run_test_sequence();
        // Base implementation - run basic sanity sequence
        i2c_single_byte_seq single_seq;
        
        `uvm_info("I2C_TEST", "Running default single byte sequence", UVM_LOW)
        
        single_seq = i2c_single_byte_seq::type_id::create("single_seq");
        single_seq.start(env.master_agent.sequencer);
    endtask
    
    //--------------------------------------------------------------------------
    // Extract Phase
    //--------------------------------------------------------------------------
    
    virtual function void extract_phase(uvm_phase phase);
        super.extract_phase(phase);
        // Extract test results if needed
    endfunction
    
    //--------------------------------------------------------------------------
    // Report Phase
    //--------------------------------------------------------------------------
    
    virtual function void report_phase(uvm_phase phase);
        uvm_report_server svr;
        int unsigned err_count;
        
        super.report_phase(phase);
        
        svr = uvm_report_server::get_server();
        err_count = svr.get_severity_count(UVM_ERROR) + svr.get_severity_count(UVM_FATAL);
        
        `uvm_info("I2C_TEST", "╔══════════════════════════════════════════════════════════════╗", UVM_LOW)
        `uvm_info("I2C_TEST", $sformatf("║  Test: %-50s   ║", get_type_name()), UVM_LOW)
        `uvm_info("I2C_TEST", "╠══════════════════════════════════════════════════════════════╣", UVM_LOW)
        
        if (err_count == 0) begin
            `uvm_info("I2C_TEST", "║               *** TEST PASSED ***                            ║", UVM_LOW)
        end else begin
            `uvm_info("I2C_TEST", $sformatf("║         *** TEST FAILED *** (%0d errors)                     ║", err_count), UVM_LOW)
        end
        
        `uvm_info("I2C_TEST", "╚══════════════════════════════════════════════════════════════╝", UVM_LOW)
    endfunction
    
endclass : i2c_base_test

//------------------------------------------------------------------------------
// Sanity Test - Single read/write
//------------------------------------------------------------------------------
class i2c_sanity_test extends i2c_base_test;
    
    `uvm_component_utils(i2c_sanity_test)
    
    function new(string name = "i2c_sanity_test", uvm_component parent = null);
        super.new(name, parent);
    endfunction
    
    virtual task run_test_sequence();
        i2c_single_byte_seq single_seq;
        
        `uvm_info("I2C_TEST", "Running I2C sanity test", UVM_LOW)
        
        single_seq = i2c_single_byte_seq::type_id::create("single_seq");
        single_seq.slave_addr = 7'h50;  // EEPROM address
        single_seq.start(env.master_agent.sequencer);
    endtask
    
endclass : i2c_sanity_test

//------------------------------------------------------------------------------
// Burst Test - Multi-byte transfers
//------------------------------------------------------------------------------
class i2c_burst_test extends i2c_base_test;
    
    `uvm_component_utils(i2c_burst_test)
    
    function new(string name = "i2c_burst_test", uvm_component parent = null);
        super.new(name, parent);
    endfunction
    
    virtual task run_test_sequence();
        i2c_burst_seq burst_seq;
        
        `uvm_info("I2C_TEST", "Running I2C burst test", UVM_LOW)
        
        burst_seq = i2c_burst_seq::type_id::create("burst_seq");
        burst_seq.slave_addr = 7'h50;
        burst_seq.num_bytes = 16;
        burst_seq.start(env.master_agent.sequencer);
    endtask
    
endclass : i2c_burst_test

//------------------------------------------------------------------------------
// Random Test - Randomized transactions
//------------------------------------------------------------------------------
class i2c_random_test extends i2c_base_test;
    
    `uvm_component_utils(i2c_random_test)
    
    int unsigned num_transactions = 50;
    
    function new(string name = "i2c_random_test", uvm_component parent = null);
        super.new(name, parent);
    endfunction
    
    virtual task run_test_sequence();
        i2c_random_seq random_seq;
        
        `uvm_info("I2C_TEST", $sformatf("Running I2C random test with %0d transactions", num_transactions), UVM_LOW)
        
        random_seq = i2c_random_seq::type_id::create("random_seq");
        random_seq.num_transactions = num_transactions;
        random_seq.start(env.master_agent.sequencer);
    endtask
    
endclass : i2c_random_test

//------------------------------------------------------------------------------
// EEPROM Test - Page read/write operations
//------------------------------------------------------------------------------
class i2c_eeprom_test extends i2c_base_test;
    
    `uvm_component_utils(i2c_eeprom_test)
    
    function new(string name = "i2c_eeprom_test", uvm_component parent = null);
        super.new(name, parent);
    endfunction
    
    virtual task run_test_sequence();
        i2c_eeprom_page_seq eeprom_seq;
        
        `uvm_info("I2C_TEST", "Running I2C EEPROM page test", UVM_LOW)
        
        // Write and read back multiple pages
        for (int page = 0; page < 4; page++) begin
            eeprom_seq = i2c_eeprom_page_seq::type_id::create($sformatf("eeprom_seq_%0d", page));
            eeprom_seq.eeprom_addr = 7'h50;
            eeprom_seq.page_addr = page * 16;
            eeprom_seq.page_size = 16;
            eeprom_seq.start(env.master_agent.sequencer);
        end
    endtask
    
endclass : i2c_eeprom_test

//------------------------------------------------------------------------------
// Fast Mode Test - 400kHz operation
//------------------------------------------------------------------------------
class i2c_fast_mode_test extends i2c_base_test;
    
    `uvm_component_utils(i2c_fast_mode_test)
    
    function new(string name = "i2c_fast_mode_test", uvm_component parent = null);
        super.new(name, parent);
    endfunction
    
    virtual function void configure_master_agent();
        super.configure_master_agent();
        master_cfg.speed_mode = I2C_FAST;
    endfunction
    
    virtual task run_test_sequence();
        i2c_burst_seq burst_seq;
        
        `uvm_info("I2C_TEST", "Running I2C Fast Mode (400kHz) test", UVM_LOW)
        
        repeat (10) begin
            burst_seq = i2c_burst_seq::type_id::create("burst_seq");
            burst_seq.slave_addr = 7'h50;
            burst_seq.num_bytes = 32;
            burst_seq.start(env.master_agent.sequencer);
        end
    endtask
    
endclass : i2c_fast_mode_test

`endif // I2C_BASE_TEST_SV
