//------------------------------------------------------------------------------
// I2C Scoreboard
// Generated by VerifAI - Natural Language to UVM Testbench Generator
//------------------------------------------------------------------------------

`ifndef I2C_SCOREBOARD_SV
`define I2C_SCOREBOARD_SV

class i2c_scoreboard extends uvm_scoreboard;
    
    `uvm_component_utils(i2c_scoreboard)
    
    //--------------------------------------------------------------------------
    // Analysis Exports
    //--------------------------------------------------------------------------
    uvm_analysis_imp #(i2c_seq_item, i2c_scoreboard) item_export;
    
    //--------------------------------------------------------------------------
    // Statistics
    //--------------------------------------------------------------------------
    int unsigned num_writes;
    int unsigned num_reads;
    int unsigned num_acks;
    int unsigned num_nacks;
    int unsigned num_transactions;
    int unsigned total_bytes_written;
    int unsigned total_bytes_read;
    
    // Per-address statistics
    int unsigned addr_transactions[logic [6:0]];
    
    //--------------------------------------------------------------------------
    // Memory Model (for EEPROM simulation)
    //--------------------------------------------------------------------------
    logic [7:0] memory[logic [15:0]];
    
    //--------------------------------------------------------------------------
    // Configuration
    //--------------------------------------------------------------------------
    bit enable_memory_model = 0;
    
    //--------------------------------------------------------------------------
    // Constructor
    //--------------------------------------------------------------------------
    
    function new(string name = "i2c_scoreboard", uvm_component parent = null);
        super.new(name, parent);
    endfunction
    
    //--------------------------------------------------------------------------
    // Build Phase
    //--------------------------------------------------------------------------
    
    virtual function void build_phase(uvm_phase phase);
        super.build_phase(phase);
        item_export = new("item_export", this);
    endfunction
    
    //--------------------------------------------------------------------------
    // Write Method (from analysis port)
    //--------------------------------------------------------------------------
    
    virtual function void write(i2c_seq_item item);
        num_transactions++;
        
        // Update per-address stats
        if (!addr_transactions.exists(item.slave_addr))
            addr_transactions[item.slave_addr] = 0;
        addr_transactions[item.slave_addr]++;
        
        // Update operation stats
        if (item.rw == I2C_WRITE) begin
            num_writes++;
            total_bytes_written += item.num_bytes;
        end else begin
            num_reads++;
            total_bytes_read += item.rx_data.size();
        end
        
        // Update result stats
        if (item.result == I2C_ACK)
            num_acks++;
        else
            num_nacks++;
        
        // Memory model checking
        if (enable_memory_model) begin
            check_memory_model(item);
        end
        
        `uvm_info("I2C_SB", $sformatf("Received transaction #%0d: addr=0x%02h, %s, %s", 
                  num_transactions, item.slave_addr, item.rw.name(), item.result.name()), UVM_HIGH)
    endfunction
    
    //--------------------------------------------------------------------------
    // Memory Model Checking
    //--------------------------------------------------------------------------
    
    virtual function void check_memory_model(i2c_seq_item item);
        // Simple memory model - assumes first byte of write is address
        if (item.rw == I2C_WRITE && item.data.size() > 1) begin
            logic [15:0] mem_addr = {item.slave_addr, item.data[0]};
            for (int i = 1; i < item.data.size(); i++) begin
                memory[mem_addr + i - 1] = item.data[i];
            end
        end
    endfunction
    
    //--------------------------------------------------------------------------
    // Report Phase
    //--------------------------------------------------------------------------
    
    virtual function void report_phase(uvm_phase phase);
        string report;
        
        report = "\n";
        report = {report, "╔══════════════════════════════════════════════════════════════╗\n"};
        report = {report, "║                  I2C Scoreboard Report                       ║\n"};
        report = {report, "╠══════════════════════════════════════════════════════════════╣\n"};
        report = {report, $sformatf("║  Total Transactions  : %-10d                          ║\n", num_transactions)};
        report = {report, $sformatf("║  Write Operations    : %-10d                          ║\n", num_writes)};
        report = {report, $sformatf("║  Read Operations     : %-10d                          ║\n", num_reads)};
        report = {report, $sformatf("║  Total Bytes Written : %-10d                          ║\n", total_bytes_written)};
        report = {report, $sformatf("║  Total Bytes Read    : %-10d                          ║\n", total_bytes_read)};
        report = {report, "╠══════════════════════════════════════════════════════════════╣\n"};
        report = {report, $sformatf("║  ACK Responses       : %-10d                          ║\n", num_acks)};
        report = {report, $sformatf("║  NACK Responses      : %-10d                          ║\n", num_nacks)};
        report = {report, "╠══════════════════════════════════════════════════════════════╣\n"};
        report = {report, $sformatf("║  Unique Addresses    : %-10d                          ║\n", addr_transactions.size())};
        report = {report, "╠══════════════════════════════════════════════════════════════╣\n"};
        
        if (num_nacks == 0 || (num_nacks < num_transactions / 10))
            report = {report, "║  STATUS: ✓ PASSED                                            ║\n"};
        else
            report = {report, "║  STATUS: ⚠ CHECK NACK RATE                                   ║\n"};
        
        report = {report, "╚══════════════════════════════════════════════════════════════╝\n"};
        
        `uvm_info("I2C_SB", report, UVM_LOW)
    endfunction
    
endclass : i2c_scoreboard

`endif // I2C_SCOREBOARD_SV
