//------------------------------------------------------------------------------
// I2C Environment
// Generated by VerifAI - Natural Language to UVM Testbench Generator
//------------------------------------------------------------------------------

`ifndef I2C_ENV_SV
`define I2C_ENV_SV

class i2c_env extends uvm_env;
    
    `uvm_component_utils(i2c_env)
    
    //--------------------------------------------------------------------------
    // Components
    //--------------------------------------------------------------------------
    i2c_agent       master_agent;
    i2c_agent       slave_agent;
    i2c_scoreboard  scoreboard;
    i2c_coverage    coverage;
    
    //--------------------------------------------------------------------------
    // Configuration
    //--------------------------------------------------------------------------
    i2c_agent_config    master_cfg;
    i2c_agent_config    slave_cfg;
    
    // Environment configuration
    bit has_master      = 1;
    bit has_slave       = 0;
    bit has_scoreboard  = 1;
    bit has_coverage    = 1;
    
    //--------------------------------------------------------------------------
    // Constructor
    //--------------------------------------------------------------------------
    
    function new(string name = "i2c_env", uvm_component parent = null);
        super.new(name, parent);
    endfunction
    
    //--------------------------------------------------------------------------
    // Build Phase
    //--------------------------------------------------------------------------
    
    virtual function void build_phase(uvm_phase phase);
        super.build_phase(phase);
        
        // Create master agent
        if (has_master) begin
            // Get or create master configuration
            if (!uvm_config_db#(i2c_agent_config)::get(this, "", "master_cfg", master_cfg)) begin
                master_cfg = i2c_agent_config::type_id::create("master_cfg");
                master_cfg.is_master = 1;
                master_cfg.is_active = UVM_ACTIVE;
            end
            uvm_config_db#(i2c_agent_config)::set(this, "master_agent*", "cfg", master_cfg);
            master_agent = i2c_agent::type_id::create("master_agent", this);
        end
        
        // Create slave agent (optional, for multi-master or slave testing)
        if (has_slave) begin
            // Get or create slave configuration
            if (!uvm_config_db#(i2c_agent_config)::get(this, "", "slave_cfg", slave_cfg)) begin
                slave_cfg = i2c_agent_config::type_id::create("slave_cfg");
                slave_cfg.is_master = 0;
                slave_cfg.is_active = UVM_ACTIVE;
            end
            uvm_config_db#(i2c_agent_config)::set(this, "slave_agent*", "cfg", slave_cfg);
            slave_agent = i2c_agent::type_id::create("slave_agent", this);
        end
        
        // Create scoreboard
        if (has_scoreboard) begin
            scoreboard = i2c_scoreboard::type_id::create("scoreboard", this);
        end
        
        // Create coverage
        if (has_coverage) begin
            coverage = i2c_coverage::type_id::create("coverage", this);
        end
    endfunction
    
    //--------------------------------------------------------------------------
    // Connect Phase
    //--------------------------------------------------------------------------
    
    virtual function void connect_phase(uvm_phase phase);
        super.connect_phase(phase);
        
        // Connect master agent monitor to scoreboard and coverage
        if (has_master && master_agent != null) begin
            if (has_scoreboard && scoreboard != null) begin
                master_agent.monitor.item_collected_port.connect(scoreboard.item_export);
            end
            if (has_coverage && coverage != null) begin
                master_agent.monitor.item_collected_port.connect(coverage.analysis_export);
            end
        end
        
        // Connect slave agent monitor if present
        if (has_slave && slave_agent != null) begin
            if (has_scoreboard && scoreboard != null) begin
                slave_agent.monitor.item_collected_port.connect(scoreboard.item_export);
            end
            if (has_coverage && coverage != null) begin
                slave_agent.monitor.item_collected_port.connect(coverage.analysis_export);
            end
        end
    endfunction
    
    //--------------------------------------------------------------------------
    // End of Elaboration Phase
    //--------------------------------------------------------------------------
    
    virtual function void end_of_elaboration_phase(uvm_phase phase);
        super.end_of_elaboration_phase(phase);
        `uvm_info("I2C_ENV", "Environment elaboration complete", UVM_LOW)
        
        // Print topology
        if (uvm_report_enabled(UVM_HIGH))
            uvm_top.print_topology();
    endfunction
    
    //--------------------------------------------------------------------------
    // Run Phase
    //--------------------------------------------------------------------------
    
    virtual task run_phase(uvm_phase phase);
        super.run_phase(phase);
        // Environment run phase - can add background processes here
    endtask
    
    //--------------------------------------------------------------------------
    // Report Phase
    //--------------------------------------------------------------------------
    
    virtual function void report_phase(uvm_phase phase);
        super.report_phase(phase);
        
        `uvm_info("I2C_ENV", "======== I2C Environment Report ========", UVM_LOW)
        
        if (has_master)
            `uvm_info("I2C_ENV", "  Master Agent: PRESENT", UVM_LOW)
        
        if (has_slave)
            `uvm_info("I2C_ENV", "  Slave Agent: PRESENT", UVM_LOW)
        
        if (has_scoreboard)
            `uvm_info("I2C_ENV", "  Scoreboard: PRESENT", UVM_LOW)
        
        if (has_coverage)
            `uvm_info("I2C_ENV", "  Coverage: PRESENT", UVM_LOW)
        
        `uvm_info("I2C_ENV", "=========================================", UVM_LOW)
    endfunction
    
endclass : i2c_env

`endif // I2C_ENV_SV
