//------------------------------------------------------------------------------
// UART Scoreboard
// Auto-generated by VerifAI
//------------------------------------------------------------------------------

class uart_scoreboard extends uvm_scoreboard;
    
    `uvm_component_utils(uart_scoreboard)
    
    //--------------------------------------------------------------------------
    // Analysis Exports
    //--------------------------------------------------------------------------
    
    uvm_analysis_imp #(uart_seq_item, uart_scoreboard) ap;
    
    //--------------------------------------------------------------------------
    // Queues for Comparison
    //--------------------------------------------------------------------------
    
    uart_seq_item tx_queue[$];
    uart_seq_item rx_queue[$];
    
    //--------------------------------------------------------------------------
    // Statistics
    //--------------------------------------------------------------------------
    
    int tx_count = 0;
    int rx_count = 0;
    int match_count = 0;
    int mismatch_count = 0;
    int error_count = 0;
    
    //--------------------------------------------------------------------------
    // Constructor
    //--------------------------------------------------------------------------
    
    function new(string name = "uart_scoreboard", uvm_component parent = null);
        super.new(name, parent);
        ap = new("ap", this);
    endfunction
    
    //--------------------------------------------------------------------------
    // Write Function (from Monitor)
    //--------------------------------------------------------------------------
    
    function void write(uart_seq_item item);
        `uvm_info("UART_SCB", $sformatf("Received: %s", item.convert2string()), UVM_HIGH)
        
        // Check for errors
        if (item.error != ERR_NONE) begin
            error_count++;
            `uvm_warning("UART_SCB", $sformatf("Error detected: %s", item.error.name()))
        end
        
        // Store for comparison
        if (item.op == UART_TX) begin
            tx_queue.push_back(item);
            tx_count++;
        end else begin
            rx_queue.push_back(item);
            rx_count++;
        end
        
        // Try to compare (if loopback or expected data)
        compare_data();
    endfunction
    
    //--------------------------------------------------------------------------
    // Compare TX and RX Data (for loopback testing)
    //--------------------------------------------------------------------------
    
    function void compare_data();
        uart_seq_item tx_item, rx_item;
        
        // Simple loopback comparison: TX should match RX
        while (tx_queue.size() > 0 && rx_queue.size() > 0) begin
            tx_item = tx_queue.pop_front();
            rx_item = rx_queue.pop_front();
            
            if (tx_item.data == rx_item.data) begin
                match_count++;
                `uvm_info("UART_SCB", $sformatf("MATCH: TX=0x%02h RX=0x%02h", 
                          tx_item.data, rx_item.data), UVM_MEDIUM)
            end else begin
                mismatch_count++;
                `uvm_error("UART_SCB", $sformatf("MISMATCH: TX=0x%02h RX=0x%02h",
                           tx_item.data, rx_item.data))
            end
        end
    endfunction
    
    //--------------------------------------------------------------------------
    // Check Phase
    //--------------------------------------------------------------------------
    
    function void check_phase(uvm_phase phase);
        super.check_phase(phase);
        
        if (tx_queue.size() > 0) begin
            `uvm_warning("UART_SCB", $sformatf("%0d TX items not compared", tx_queue.size()))
        end
        
        if (rx_queue.size() > 0) begin
            `uvm_warning("UART_SCB", $sformatf("%0d RX items not compared", rx_queue.size()))
        end
    endfunction
    
    //--------------------------------------------------------------------------
    // Report Phase
    //--------------------------------------------------------------------------
    
    function void report_phase(uvm_phase phase);
        super.report_phase(phase);
        
        `uvm_info("UART_SCB", "========== UART Scoreboard Report ==========", UVM_NONE)
        `uvm_info("UART_SCB", $sformatf("TX Transactions:  %0d", tx_count), UVM_NONE)
        `uvm_info("UART_SCB", $sformatf("RX Transactions:  %0d", rx_count), UVM_NONE)
        `uvm_info("UART_SCB", $sformatf("Matches:          %0d", match_count), UVM_NONE)
        `uvm_info("UART_SCB", $sformatf("Mismatches:       %0d", mismatch_count), UVM_NONE)
        `uvm_info("UART_SCB", $sformatf("Errors Detected:  %0d", error_count), UVM_NONE)
        `uvm_info("UART_SCB", "=============================================", UVM_NONE)
        
        if (mismatch_count > 0) begin
            `uvm_error("UART_SCB", "TEST FAILED: Data mismatches detected")
        end else if (match_count > 0) begin
            `uvm_info("UART_SCB", "TEST PASSED: All data matched", UVM_NONE)
        end
    endfunction
    
endclass : uart_scoreboard
