//------------------------------------------------------------------------------
// UART Top-Level Testbench
// Auto-generated by VerifAI
//------------------------------------------------------------------------------

`timescale 1ns/1ps

module uart_top_tb;
    
    //--------------------------------------------------------------------------
    // Parameters
    //--------------------------------------------------------------------------
    
    parameter CLK_PERIOD = 10;  // 100 MHz clock
    parameter BAUD_RATE = {{ baud_rate }};
    parameter BIT_PERIOD = 1_000_000_000 / BAUD_RATE;  // in ns
    
    //--------------------------------------------------------------------------
    // Clock and Reset
    //--------------------------------------------------------------------------
    
    logic clk;
    logic rst_n;
    
    // Clock generation
    initial begin
        clk = 0;
        forever #(CLK_PERIOD/2) clk = ~clk;
    end
    
    // Reset generation
    initial begin
        rst_n = 0;
        repeat(10) @(posedge clk);
        rst_n = 1;
    end
    
    //--------------------------------------------------------------------------
    // Interface
    //--------------------------------------------------------------------------
    
    uart_if uart_vif(clk, rst_n);
    
    //--------------------------------------------------------------------------
    // DUT Instance
    //--------------------------------------------------------------------------
    
    // TODO: Replace with actual DUT
    // {{ dut_name }} u_dut (
    //     .clk        (clk),
    //     .rst_n      (rst_n),
    //     .uart_tx    (uart_vif.tx),
    //     .uart_rx    (uart_vif.rx)
    // );
    
    // Loopback for self-test (connect TX to RX)
    assign uart_vif.rx = uart_vif.tx;
    
    //--------------------------------------------------------------------------
    // UVM Configuration
    //--------------------------------------------------------------------------
    
    initial begin
        // Set virtual interface
        uvm_config_db#(virtual uart_if)::set(null, "*", "vif", uart_vif);
        
        // Initialize TX to idle
        uart_vif.tx = 1'b1;
{% if has_rts_cts %}
        uart_vif.cts = 1'b0;  // Always ready
{% endif %}
        
        // Run test
        run_test();
    end
    
    //--------------------------------------------------------------------------
    // Waveform Dump
    //--------------------------------------------------------------------------
    
    initial begin
        $dumpfile("uart_tb.vcd");
        $dumpvars(0, uart_top_tb);
    end
    
    //--------------------------------------------------------------------------
    // Timeout
    //--------------------------------------------------------------------------
    
    initial begin
        #(BIT_PERIOD * 10000 * 1ns);  // Timeout after ~10000 bytes
        `uvm_fatal("TIMEOUT", "Simulation timeout")
    end
    
endmodule : uart_top_tb
