//------------------------------------------------------------------------------
// SPI Agent
// Generated by VerifAI - Natural Language to UVM Testbench Generator
//------------------------------------------------------------------------------

`ifndef SPI_AGENT_SV
`define SPI_AGENT_SV

class spi_agent extends uvm_agent;
    
    `uvm_component_utils(spi_agent)
    
    //--------------------------------------------------------------------------
    // Components
    //--------------------------------------------------------------------------
    spi_driver    driver;
    spi_monitor   monitor;
    spi_sequencer sequencer;
    
    //--------------------------------------------------------------------------
    // Configuration
    //--------------------------------------------------------------------------
    uvm_active_passive_enum is_active = UVM_ACTIVE;
    bit is_master = 1;  // Master or slave agent
    
    //--------------------------------------------------------------------------
    // Analysis Port (passthrough from monitor)
    //--------------------------------------------------------------------------
    uvm_analysis_port #(spi_seq_item) item_collected_port;
    
    //--------------------------------------------------------------------------
    // Constructor
    //--------------------------------------------------------------------------
    
    function new(string name = "spi_agent", uvm_component parent = null);
        super.new(name, parent);
    endfunction
    
    //--------------------------------------------------------------------------
    // Build Phase
    //--------------------------------------------------------------------------
    
    virtual function void build_phase(uvm_phase phase);
        super.build_phase(phase);
        
        // Always create monitor
        monitor = spi_monitor::type_id::create("monitor", this);
        
        // Create driver and sequencer only if active
        if (is_active == UVM_ACTIVE) begin
            driver = spi_driver::type_id::create("driver", this);
            sequencer = spi_sequencer::type_id::create("sequencer", this);
        end
        
        // Create analysis port
        item_collected_port = new("item_collected_port", this);
    endfunction
    
    //--------------------------------------------------------------------------
    // Connect Phase
    //--------------------------------------------------------------------------
    
    virtual function void connect_phase(uvm_phase phase);
        super.connect_phase(phase);
        
        // Connect driver to sequencer if active
        if (is_active == UVM_ACTIVE) begin
            driver.seq_item_port.connect(sequencer.seq_item_export);
            driver.is_master = this.is_master;
        end
        
        // Connect monitor analysis port
        monitor.item_collected_port.connect(this.item_collected_port);
    endfunction
    
    //--------------------------------------------------------------------------
    // Get Methods
    //--------------------------------------------------------------------------
    
    function spi_sequencer get_sequencer();
        return sequencer;
    endfunction
    
endclass : spi_agent

`endif // SPI_AGENT_SV
