//------------------------------------------------------------------------------
// SPI UVM Environment
// Generated by VerifAI - Natural Language to UVM Testbench Generator
//------------------------------------------------------------------------------

`ifndef SPI_ENV_SV
`define SPI_ENV_SV

class spi_env extends uvm_env;
    
    `uvm_component_utils(spi_env)
    
    //--------------------------------------------------------------------------
    // Components
    //--------------------------------------------------------------------------
    spi_agent     master_agent;
    spi_agent     slave_agent;      // Optional slave agent for loopback testing
    spi_scoreboard scoreboard;
    spi_coverage  coverage;
    
    //--------------------------------------------------------------------------
    // Configuration
    //--------------------------------------------------------------------------
    bit has_scoreboard = 1;
    bit has_coverage = 1;
    bit has_slave_agent = 0;  // Enable for loopback testing
    
    //--------------------------------------------------------------------------
    // Constructor
    //--------------------------------------------------------------------------
    
    function new(string name = "spi_env", uvm_component parent = null);
        super.new(name, parent);
    endfunction
    
    //--------------------------------------------------------------------------
    // Build Phase
    //--------------------------------------------------------------------------
    
    virtual function void build_phase(uvm_phase phase);
        super.build_phase(phase);
        
        // Create master agent (always present)
        master_agent = spi_agent::type_id::create("master_agent", this);
        master_agent.is_active = UVM_ACTIVE;
        master_agent.is_master = 1;
        
        // Create slave agent if enabled
        if (has_slave_agent) begin
            slave_agent = spi_agent::type_id::create("slave_agent", this);
            slave_agent.is_active = UVM_ACTIVE;
            slave_agent.is_master = 0;
        end
        
        // Create scoreboard if enabled
        if (has_scoreboard) begin
            scoreboard = spi_scoreboard::type_id::create("scoreboard", this);
        end
        
        // Create coverage collector if enabled
        if (has_coverage) begin
            coverage = spi_coverage::type_id::create("coverage", this);
        end
        
        `uvm_info("SPI_ENV", "Environment build complete", UVM_MEDIUM)
    endfunction
    
    //--------------------------------------------------------------------------
    // Connect Phase
    //--------------------------------------------------------------------------
    
    virtual function void connect_phase(uvm_phase phase);
        super.connect_phase(phase);
        
        // Connect master agent to scoreboard
        if (has_scoreboard) begin
            master_agent.item_collected_port.connect(scoreboard.master_export);
        end
        
        // Connect master agent to coverage
        if (has_coverage) begin
            master_agent.item_collected_port.connect(coverage.analysis_export);
        end
        
        `uvm_info("SPI_ENV", "Environment connect complete", UVM_MEDIUM)
    endfunction
    
    //--------------------------------------------------------------------------
    // Run Phase
    //--------------------------------------------------------------------------
    
    virtual task run_phase(uvm_phase phase);
        super.run_phase(phase);
    endtask
    
    //--------------------------------------------------------------------------
    // Get Methods
    //--------------------------------------------------------------------------
    
    function spi_sequencer get_master_sequencer();
        return master_agent.get_sequencer();
    endfunction
    
    function spi_sequencer get_slave_sequencer();
        if (has_slave_agent)
            return slave_agent.get_sequencer();
        else
            return null;
    endfunction
    
endclass : spi_env

`endif // SPI_ENV_SV
